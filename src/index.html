<!DOCTYPE html>
<html lang="en">
<head>
    <title>Title of the document</title>
</head>
<body>
<h1>This is kiko</h1>
<h2 id="connection-status"></h2>
<label>
    <input type="text" id="inputMessage">
    <button type="button" id="sendMessageButton">Send the message</button>
</label>
<h3>Messages</h3>
<ul id="messages-list">
</ul>
<script>
    const conn = new WebSocket('ws://localhost:8080');
    const connectionStatus = document.getElementById("connection-status");
    const inputMessage = document.querySelector("#inputMessage")
    const sendMessageButton = document.querySelector("#sendMessageButton")

    conn.onopen = function () {
        connectionStatus.innerText = "Connection established!";
    };

    conn.onmessage = function (e) {
        console.log("Event from onmessage", e);

        const list = document.getElementById("messages-list");
        const item = document.createElement("li");

        item.innerText = JSON.parse(e.data).msg+ "\n" + new Date(JSON.parse(e.data).date);
        list.appendChild(item);
    };

    let message = {};

    addEventListener("input", function (e) {
        message = {
            msg: e.target.value,
            date: Date.now(),
        };
    })

    inputMessage.addEventListener("keypress", function (e) {
        if (e.key === "Enter") {
            e.preventDefault();
            sendMessageButton.click();
        }
    })

    sendMessageButton.addEventListener("click", function () {
        conn.send(JSON.stringify(message));
        inputMessage.value = "";
    })
</script>
</body>
</html>

